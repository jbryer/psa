<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Effects of Tutoring on Course Grades | Applied Propensity Score Analysis with R</title>
<meta name="author" content="Jason Bryer, Ph.D.">
<meta name="description" content="In the first example we will utilize observational data obtained to evaluate the effectiveness of tutoring services on course grades. Treatment students consisted of those students who used...">
<meta name="generator" content="bookdown 0.42 with bs4_book()">
<meta property="og:title" content="Chapter 10 Effects of Tutoring on Course Grades | Applied Propensity Score Analysis with R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psa.bryer.org/effects-of-tutoring-on-course-grades.html">
<meta property="og:image" content="https://psa.bryer.org/images/cover.png">
<meta property="og:description" content="In the first example we will utilize observational data obtained to evaluate the effectiveness of tutoring services on course grades. Treatment students consisted of those students who used...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 Effects of Tutoring on Course Grades | Applied Propensity Score Analysis with R">
<meta name="twitter:description" content="In the first example we will utilize observational data obtained to evaluate the effectiveness of tutoring services on course grades. Treatment students consisted of those students who used...">
<meta name="twitter:image" content="https://psa.bryer.org/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Applied Propensity Score Analysis with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="chapter-introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="chapter-stratification.html"><span class="header-section-number">2</span> Stratification</a></li>
<li><a class="" href="chapter-matching.html"><span class="header-section-number">3</span> Matching</a></li>
<li><a class="" href="chapter-weighting.html"><span class="header-section-number">4</span> Weighting</a></li>
<li><a class="" href="chapter-sensitivity.html"><span class="header-section-number">5</span> Sensitivity Analysis</a></li>
<li><a class="" href="chapter-bootstrapping.html"><span class="header-section-number">6</span> Bootstrapping</a></li>
<li><a class="" href="chapter-missing.html"><span class="header-section-number">7</span> Missing Data</a></li>
<li><a class="" href="chapter-non-binary.html"><span class="header-section-number">8</span> Non-Binary Treatments</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">9</span> Introduction</a></li>
<li><a class="active" href="effects-of-tutoring-on-course-grades.html"><span class="header-section-number">10</span> Effects of Tutoring on Course Grades</a></li>
<li><a class="" href="effects-of-smoking-on-medical-expenditures.html"><span class="header-section-number">11</span> Effects of Smoking on Medical Expenditures</a></li>
<li><a class="" href="chapter-multilevelpsa.html"><span class="header-section-number">12</span> Multilevel PSA</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="appendix-shiny.html"><span class="header-section-number">A</span> Shiny Applications</a></li>
<li><a class="" href="appendix-psranges.html"><span class="header-section-number">B</span> Propensity Score Ranges</a></li>
<li><a class="" href="appendix-psmodels.html"><span class="header-section-number">C</span> Methods for Estimating Propensity Scores</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jbryer/psa">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="effects-of-tutoring-on-course-grades" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Effects of Tutoring on Course Grades<a class="anchor" aria-label="anchor" href="#effects-of-tutoring-on-course-grades"><i class="fas fa-link"></i></a>
</h1>
<p>In the first example we will utilize observational data obtained to evaluate the effectiveness of tutoring services on course grades. Treatment students consisted of those students who used tutoring services while enrolled in a online writing course between 2008 and 2011. A comparison group was identified as students enrolled in a course section with a student who used tutoring services. The treatment group was then divided into two based upon the number of times they utilized tutoring services. “Novice” users are those who used the services once and “regular” users are those who used services two or more times. Covariates available for estimating propensity scores are gender, ethnicity, military status, English second language learner, educational level for mother and father, age at the beginning of the course, employment level at college enrollment, income level at college enrollment, number of transfer credits, and GPA at the start of the course.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tutoring</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "treat"      "Course"     "Grade"      "Gender"     "Ethnicity" 
##  [6] "Military"   "ESL"        "EdMother"   "EdFather"   "Age"       
## [11] "Employment" "Income"     "Transfer"   "GPA"        "GradeCode" 
## [16] "Level"      "ID"         "treat2"</code></pre>
<p>The courses represented here are structured such that the variation from section-to-section is minimal. However, the differences between courses is substantial and therefore we will utilize partial exact matching so that all matched students will have taken the same course.</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">tutoring</span><span class="op">$</span><span class="va">treat</span>, <span class="va">tutoring</span><span class="op">$</span><span class="va">Course</span>, useNA<span class="op">=</span><span class="st">"ifany"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##          
##           ENG*101 ENG*201 HSC*310
##   Control     349     518      51
##   Treat1       22      36      76
##   Treat2       31      32      27</code></pre>
<p>The first step of analysis is to estimate the propensity scores. The <code>trips</code> function will estimate three propensity score models, <span class="math inline">\(PS_1\)</span>, <span class="math inline">\(PS_2\)</span>, and <span class="math inline">\(PS_3\)</span> as described above. Note that when specifying the formula the dependent variable, or treatment indicator, is not included. The <code>trips</code> function will replace the dependent variable as it estimates the three logistic regression models.</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formu</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Gender</span> <span class="op">+</span> <span class="va">Ethnicity</span> <span class="op">+</span> <span class="va">Military</span> <span class="op">+</span> <span class="va">ESL</span> <span class="op">+</span> <span class="va">EdMother</span> <span class="op">+</span> <span class="va">EdFather</span> <span class="op">+</span> </span>
<span><span class="va">Age</span> <span class="op">+</span> <span class="va">Employment</span> <span class="op">+</span> <span class="va">Income</span> <span class="op">+</span> <span class="va">Transfer</span> <span class="op">+</span> <span class="va">GPA</span></span>
<span><span class="va">tutoring.tpsa</span> <span class="op">&lt;-</span> <span class="fu">trips</span><span class="op">(</span><span class="va">tutoring</span>, <span class="va">tutoring</span><span class="op">$</span><span class="va">treat</span>, <span class="va">formu</span><span class="op">)</span></span></code></pre></div>
<p>Figure <a href="effects-of-tutoring-on-course-grades.html#fig:triangleplot">10.1</a> is a triangle plot that depicts the propensity scores from the three models. Since each student has two propensity scores, their scores are connected with a line. The black line in Figure <a href="effects-of-tutoring-on-course-grades.html#fig:triangleplot">10.1</a> represents one matched triplet estimated below.</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tutoring.tpsa</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="08-TriMatch_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>The default for <code>trimatch</code> is to use the <code>maximumTreat</code> method retaining each treatment unit once with treatment one units matched more than once only if the corresponding treatment two unit would not be matched otherwise.</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tutoring.matched</span> <span class="op">&lt;-</span> <span class="fu">trimatch</span><span class="op">(</span><span class="va">tutoring.tpsa</span>, exact<span class="op">=</span><span class="va">tutoring</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Course"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Setting the <code>method</code> parameter to <code>NULL</code> will result in caliper matching. All matched triplets within the specified caliper are retained. This will result in the largest number of matched triplets.</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tutoring.matched.caliper</span> <span class="op">&lt;-</span> <span class="fu">trimatch</span><span class="op">(</span><span class="va">tutoring.tpsa</span>, </span>
<span>exact<span class="op">=</span><span class="va">tutoring</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Course"</span><span class="op">)</span><span class="op">]</span>, method<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>Lastly, we will use the <code>OneToN</code> method to retain a 2-to-1-to-n and 3-to-2-n matches.</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tutoring.matched.2to1</span> <span class="op">&lt;-</span> <span class="fu">trimatch</span><span class="op">(</span><span class="va">tutoring.tpsa</span>, </span>
<span>exact<span class="op">=</span><span class="va">tutoring</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Course"</span><span class="op">)</span><span class="op">]</span>, method<span class="op">=</span><span class="va">OneToN</span>, M1<span class="op">=</span><span class="fl">2</span>, M2<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">tutoring.matched.3to2</span> <span class="op">&lt;-</span> <span class="fu">trimatch</span><span class="op">(</span><span class="va">tutoring.tpsa</span>, </span>
<span>exact<span class="op">=</span><span class="va">tutoring</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Course"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>method<span class="op">=</span><span class="va">OneToN</span>, M1<span class="op">=</span><span class="fl">3</span>, M2<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tutoring.matched</span>, rows<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>, line.alpha<span class="op">=</span><span class="fl">1</span>, draw.segments<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:triangleplot"></span>
<img src="08-TriMatch_files/figure-html/triangleplot-1.png" alt="Traingle Plot" width="100%"><p class="caption">
Figure 10.1: Traingle Plot
</p>
</div>
<div id="examining-unmatched-students" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Examining Unmatched Students<a class="anchor" aria-label="anchor" href="#examining-unmatched-students"><i class="fas fa-link"></i></a>
</h2>
<p>The different methods for retaining matched triplets address the issue of overrepresentation of treatment units. In this example there four times as many control units as treatment units (the ratio is larger when considering the treatments separately). These methods fall on a spectrum where each treatment unit is used minimally (<code>maximumTreat</code> method) or all units are used (caliper matching). <span class="citation">(Rosenbaum 2012)</span> suggests testing hypothesis more than once and it is our general recommendation to utilize multiple methods. Functions to help present and compare the results from multiple methods are provided and discussed below.</p>
<p>The <code>unmatched</code> function will return the rows of students who were not matched. The <code>summary</code> function will provide information about how many students within each group were not matched. As shown below, the caliper matching will match the most students. In this particular example, in fact, the only substantial difference in the unmatched students is with the control group. All methods fail to match 37 treatment one students. This is due to the fact that there is not another student within the specified caliper that match exactly on the course.</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">unmatched</span><span class="op">(</span><span class="va">tutoring.matched</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 892 (78.1%) of 1142 total data points were not matched.
## Unmatched by treatment:
##     Control      Treat1      Treat2 
## 834 (90.8%)  39 (29.1%)  19 (21.1%)</code></pre>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">unmatched</span><span class="op">(</span><span class="va">tutoring.matched.caliper</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 638 (55.9%) of 1142 total data points were not matched.
## Unmatched by treatment:
##     Control      Treat1      Treat2 
## 580 (63.2%)  39 (29.1%)  19 (21.1%)</code></pre>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">unmatched</span><span class="op">(</span><span class="va">tutoring.matched.2to1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 1000 (87.6%) of 1142 total data points were not matched.
## Unmatched by treatment:
##     Control      Treat1      Treat2 
## 870 (94.8%)  97 (72.4%)  33 (36.7%)</code></pre>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">unmatched</span><span class="op">(</span><span class="va">tutoring.matched.3to2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 928 (81.3%) of 1142 total data points were not matched.
## Unmatched by treatment:
##     Control      Treat1      Treat2 
## 831 (90.5%)    75 (56%)  22 (24.4%)</code></pre>
</div>
<div id="checking-balance-2" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Checking Balance<a class="anchor" aria-label="anchor" href="#checking-balance-2"><i class="fas fa-link"></i></a>
</h2>
<p>The eventual strength of propensity score methods is dependent on how well balance is achieved. <span class="citation">(J. E. Helmreich and Pruzek 2009)</span> introduced graphical approaches to evaluating balance. We provide functions that extend that framework to matching of three groups. Figure <a href="effects-of-tutoring-on-course-grades.html#fig:multibalance">10.2</a> is a multiple covariate balance plot that plots the absolute effect size of each covariate before and after adjustment. In this example, the figure suggests that reasonable balance has been achieved across all covariates and across all three models since effect sizes are smaller than the unadjusted in most cases and relatively small.</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">multibalance.plot</span><span class="op">(</span><span class="va">tutoring.tpsa</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Covariate Balance Plot"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:multibalance"></span>
<img src="08-TriMatch_files/figure-html/multibalance-1.png" alt="Multiple Covariate Balance Plot of Absolute Standardized Effect Sizes Before and After Propensity Score Adjustment" width="100%"><p class="caption">
Figure 10.2: Multiple Covariate Balance Plot of Absolute Standardized Effect Sizes Before and After Propensity Score Adjustment
</p>
</div>
<p>Figure <a href="effects-of-tutoring-on-course-grades.html#fig:balance">10.3</a> is the results of the <code>balance.plot</code> function. This function will provide a bar chart for categorical covariates and box plots for quantitative covariates, individually or in a grid.</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bplots</span> <span class="op">&lt;-</span> <span class="fu">balance.plot</span><span class="op">(</span><span class="va">tutoring.matched</span>, <span class="va">tutoring</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/allnames.html">all.vars</a></span><span class="op">(</span><span class="va">formu</span><span class="op">)</span><span class="op">]</span>, </span>
<span>        legend.position<span class="op">=</span><span class="st">"none"</span>, x.axis.labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="st">"T1"</span>,<span class="st">"T1"</span><span class="op">)</span>, x.axis.angle<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">bplots</span>, cols<span class="op">=</span><span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:balance"></span>
<img src="08-TriMatch_files/figure-html/balance-1.png" alt="Covariate Balance Plots" width="100%"><p class="caption">
Figure 10.3: Covariate Balance Plots
</p>
</div>
<pre><code>## NULL</code></pre>
</div>
<div id="phase-ii-estimating-effects-of-tutoring-on-course-grades" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Phase II: Estimating Effects of Tutoring on Course Grades<a class="anchor" aria-label="anchor" href="#phase-ii-estimating-effects-of-tutoring-on-course-grades"><i class="fas fa-link"></i></a>
</h2>
<p>In phase two of propensity score analysis we wish to compare our outcome of interest, course grade in this example, across the matches. A custom <code>merge</code> function is provided to merge an outcome from the original data frame to the results of <code>trimatch</code>. This merge function will add three columns with the outcome for each of the three groups.</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">tutoring.matched</span>, <span class="va">tutoring</span><span class="op">$</span><span class="va">Grade</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">matched.out</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "Treat1"      "Treat2"      "Control"     "D.m3"        "D.m2"       
##  [6] "D.m1"        "Dtotal"      "Treat1.out"  "Treat2.out"  "Control.out"</code></pre>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">matched.out</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   Treat1 Treat2 Control        D.m3        D.m2         D.m1     Dtotal
## 1    368     39     331 0.007053754 0.001788577 1.039322e-02 0.01923555
## 2    158    279     365 0.003373585 0.009530680 1.071188e-02 0.02361614
## 3    899    209     100 0.001929173 0.013633300 9.183572e-03 0.02474604
## 4    692    596    1055 0.023785086 0.010292177 1.862058e-03 0.03593932
## 5    616    209     208 0.020203398 0.016562521 3.168865e-05 0.03679761
## 6     28    852     154 0.007501996 0.014214100 1.776640e-02 0.03948249
##   Treat1.out Treat2.out Control.out
## 1          4          4           0
## 2          4          4           4
## 3          4          3           4
## 4          4          3           4
## 5          4          3           0
## 6          4          4           2</code></pre>
<p>Although the <code>merge</code> function is convenient for conducting your own analysis, the <code>summary</code> function will perform the most common analyses including Friedman Rank Sum test and repeated measures ANOVA. If either of those tests produce a <em>p</em> value less than the specified threshold (0.05 by default), then the <code>summary</code> function will also perform and return Wilcoxon signed rank test and three separate dependent sample <em>t</em>-tests see <span class="citation">(Austin 2010)</span> for discussion of dependent versus independent <em>t</em>-tests.</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">tutoring.matched</span>, <span class="va">tutoring</span><span class="op">$</span><span class="va">Grade</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "PercentMatched"       "friedman.test"        "rmanova"             
## [4] "pairwise.wilcox.test" "t.tests"</code></pre>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span><span class="op">$</span><span class="va">friedman.test</span></span></code></pre></div>
<pre><code>## 
##  Friedman rank sum test
## 
## data:  Outcome and Treatment and ID
## Friedman chi-squared = 27.904, df = 2, p-value = 8.726e-07</code></pre>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span><span class="op">$</span><span class="va">t.tests</span></span></code></pre></div>
<pre><code>##               Treatments         t  df      p.value sig  mean.diff     ci.min
## 1  Treat1.out-Treat2.out -2.791302 117 6.132601e-03  ** -0.3220339 -0.5505191
## 2 Treat1.out-Control.out  3.817862 117 2.168534e-04 ***  0.7033898  0.3385190
## 3 Treat2.out-Control.out  6.922623 117 2.539540e-10 ***  1.0254237  0.7320670
##        ci.max
## 1 -0.09354868
## 2  1.06826071
## 3  1.31878047</code></pre>
<p>The <code>print</code> method will accept multiple object returned by <code>summary</code> so to combine them into a single table output. Note that each parameter must be named and that name will be used to identify the row containing those results.</p>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">tutoring.matched.caliper</span>, <span class="va">tutoring</span><span class="op">$</span><span class="va">Grade</span><span class="op">)</span></span>
<span><span class="va">s3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">tutoring.matched.2to1</span>, <span class="va">tutoring</span><span class="op">$</span><span class="va">Grade</span><span class="op">)</span></span>
<span><span class="va">s4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">tutoring.matched.3to2</span>, <span class="va">tutoring</span><span class="op">$</span><span class="va">Grade</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Max Treat"</span><span class="op">=</span><span class="va">s1</span>, <span class="st">"Caliper"</span><span class="op">=</span><span class="va">s2</span>, <span class="st">"2-to-1"</span><span class="op">=</span><span class="va">s3</span>, <span class="st">"3-to-2"</span><span class="op">=</span><span class="va">s4</span><span class="op">)</span></span></code></pre></div>
<pre><code>##      Method Friedman.chi2   Friedman.p     rmANOVA.F    rmANOVA.p    
## 1 Max Treat      27.90354 8.726175e-07 ***  23.84506 3.758176e-10 ***
## 2   Caliper     112.99646 2.904890e-25 *** 108.21057 2.374092e-45 ***
## 3    2-to-1      18.95541 7.653924e-05 ***  15.54945 1.097932e-06 ***
## 4    3-to-2      32.27083 9.828281e-08 ***  25.03567 1.538341e-10 ***</code></pre>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">boxdiff.plot</span><span class="op">(</span><span class="va">tutoring.matched</span>, <span class="va">tutoring</span><span class="op">$</span><span class="va">Grade</span>, </span>
<span>             ordering<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Treat2"</span>,<span class="st">"Treat1"</span>,<span class="st">"Control"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Maximum Treatment Matching"</span><span class="op">)</span></span>
<span><span class="fu">boxdiff.plot</span><span class="op">(</span><span class="va">tutoring.matched.caliper</span>, <span class="va">tutoring</span><span class="op">$</span><span class="va">Grade</span>, </span>
<span>             ordering<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Treat2"</span>,<span class="st">"Treat1"</span>,<span class="st">"Control"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Caliper Matching"</span><span class="op">)</span></span>
<span><span class="fu">boxdiff.plot</span><span class="op">(</span><span class="va">tutoring.matched.2to1</span>, <span class="va">tutoring</span><span class="op">$</span><span class="va">Grade</span>, </span>
<span>             ordering<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Treat2"</span>,<span class="st">"Treat1"</span>,<span class="st">"Control"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"2-to-1-to-n Matching"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:boxplots"></span>
<img src="08-TriMatch_files/figure-html/boxplots-1.png" alt="Boxplot of Differences" width="30%"><img src="08-TriMatch_files/figure-html/boxplots-2.png" alt="Boxplot of Differences" width="30%"><img src="08-TriMatch_files/figure-html/boxplots-3.png" alt="Boxplot of Differences" width="30%"><p class="caption">
Figure 10.4: Boxplot of Differences
</p>
</div>
<p>Another useful visualization for presenting the results is the Loess plot. In Figure <a href="effects-of-tutoring-on-course-grades.html#fig:loess">10.5</a> we plot the propensity scores on the <em>x</em>-axis and the outcome (grade in this example) on the <em>y</em>-axis. A Loess regression line is then overlaid.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;We utilize the &lt;code&gt;geom_smooth&lt;/code&gt; geometry in the &lt;code&gt;ggplot2&lt;/code&gt; package that provides other smoothing functions including linear modeling (&lt;code&gt;lm&lt;/code&gt;), generalized linear modeling (&lt;code&gt;glm&lt;/code&gt;), and robust generalized additive models (&lt;code&gt;gam&lt;/code&gt;). See the documentation for the &lt;code&gt;stat_smooth&lt;/code&gt; function in &lt;code&gt;ggplot2&lt;/code&gt;.&lt;/p&gt;"><sup>4</sup></a> Since there are three propensity score scales, the <code>plot.loess3</code> function will use the propensity scores from the model predicting treatment one from treatment two. Propensity scores for the control group are then imputed by taking the mean of the propensity scores of the two treatment units that control was matched to. It should be noted that if a control unit is matched to two different sets of treatment units, then that control unit will have two propensity scores. Which propensity score scale is utilized can be explicitly specified using the <code>model</code> parameter.</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">loess3.plot</span><span class="op">(</span><span class="va">tutoring.matched.caliper</span>, <span class="va">tutoring</span><span class="op">$</span><span class="va">Grade</span>, ylab<span class="op">=</span><span class="st">"Grade"</span>, </span>
<span>            points.alpha<span class="op">=</span><span class="fl">.1</span>, method<span class="op">=</span><span class="st">"loess"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:loess"></span>
<img src="08-TriMatch_files/figure-html/loess-1.png" alt="Loess Plot for Caliper Matching" width="100%"><p class="caption">
Figure 10.5: Loess Plot for Caliper Matching
</p>
</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="introduction.html"><span class="header-section-number">9</span> Introduction</a></div>
<div class="next"><a href="effects-of-smoking-on-medical-expenditures.html"><span class="header-section-number">11</span> Effects of Smoking on Medical Expenditures</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>In this chapter</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#effects-of-tutoring-on-course-grades"><span class="header-section-number">10</span> Effects of Tutoring on Course Grades</a></li>
<li><a class="nav-link" href="#examining-unmatched-students"><span class="header-section-number">10.1</span> Examining Unmatched Students</a></li>
<li><a class="nav-link" href="#checking-balance-2"><span class="header-section-number">10.2</span> Checking Balance</a></li>
<li><a class="nav-link" href="#phase-ii-estimating-effects-of-tutoring-on-course-grades"><span class="header-section-number">10.3</span> Phase II: Estimating Effects of Tutoring on Course Grades</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jbryer/psa/blob/master/book/08-TriMatch.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jbryer/psa/edit/master/book/08-TriMatch.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
      <div class="book-extra">
        <ul class="list-unstyled">
<li><a href="https://github.com/jbryer/psa/actions/workflows/bookdown.yaml"><img src="https://github.com/jbryer/psa/actions/workflows/bookdown.yaml/badge.svg" alt="Bookdown Status"></a></li>
          <li><a href="https://www.repostatus.org/#wip"><img src="https://www.repostatus.org/badges/latest/wip.svg" border="0" alt="Project Status: WIP - Initial development is in progress, but there has not yet been a stable, usable release suitable for the public."></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Applied Propensity Score Analysis with R</strong>" was written by Jason Bryer, Ph.D.. It was last built on 2025-04-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
