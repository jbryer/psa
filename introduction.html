<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Introduction | Applied Propensity Score Analysis with R</title>
<meta name="author" content="Jason Bryer, Ph.D.">
<meta name="description" content="Consider two treatments, \(Tr_1\) and \(Tr_2\), and a control, \(C\). We estimate propensity scores with three separate logistic regression models where model one predicts \(Tr_1\) with \(C\),...">
<meta name="generator" content="bookdown 0.42 with bs4_book()">
<meta property="og:title" content="Chapter 9 Introduction | Applied Propensity Score Analysis with R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psa.bryer.org/introduction.html">
<meta property="og:image" content="https://psa.bryer.org/images/cover.png">
<meta property="og:description" content="Consider two treatments, \(Tr_1\) and \(Tr_2\), and a control, \(C\). We estimate propensity scores with three separate logistic regression models where model one predicts \(Tr_1\) with \(C\),...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 9 Introduction | Applied Propensity Score Analysis with R">
<meta name="twitter:description" content="Consider two treatments, \(Tr_1\) and \(Tr_2\), and a control, \(C\). We estimate propensity scores with three separate logistic regression models where model one predicts \(Tr_1\) with \(C\),...">
<meta name="twitter:image" content="https://psa.bryer.org/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Applied Propensity Score Analysis with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="chapter-introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="chapter-stratification.html"><span class="header-section-number">2</span> Stratification</a></li>
<li><a class="" href="chapter-matching.html"><span class="header-section-number">3</span> Matching</a></li>
<li><a class="" href="chapter-weighting.html"><span class="header-section-number">4</span> Weighting</a></li>
<li><a class="" href="chapter-sensitivity.html"><span class="header-section-number">5</span> Sensitivity Analysis</a></li>
<li><a class="" href="chapter-bootstrapping.html"><span class="header-section-number">6</span> Bootstrapping</a></li>
<li><a class="" href="chapter-missing.html"><span class="header-section-number">7</span> Missing Data</a></li>
<li><a class="" href="chapter-non-binary.html"><span class="header-section-number">8</span> Non-Binary Treatments</a></li>
<li><a class="active" href="introduction.html"><span class="header-section-number">9</span> Introduction</a></li>
<li><a class="" href="effects-of-tutoring-on-course-grades.html"><span class="header-section-number">10</span> Effects of Tutoring on Course Grades</a></li>
<li><a class="" href="effects-of-smoking-on-medical-expenditures.html"><span class="header-section-number">11</span> Effects of Smoking on Medical Expenditures</a></li>
<li><a class="" href="chapter-multilevelpsa.html"><span class="header-section-number">12</span> Multilevel PSA</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="appendix-shiny.html"><span class="header-section-number">A</span> Shiny Applications</a></li>
<li><a class="" href="appendix-psranges.html"><span class="header-section-number">B</span> Propensity Score Ranges</a></li>
<li><a class="" href="appendix-psmodels.html"><span class="header-section-number">C</span> Methods for Estimating Propensity Scores</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jbryer/psa">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="introduction" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"><i class="fas fa-link"></i></a>
</h1>
<p>Consider two treatments, <span class="math inline">\(Tr_1\)</span> and <span class="math inline">\(Tr_2\)</span>, and a control, <span class="math inline">\(C\)</span>. We estimate propensity scores with three separate logistic regression models where model one predicts <span class="math inline">\(Tr_1\)</span> with <span class="math inline">\(C\)</span>, model two predicts <span class="math inline">\(Tr_2\)</span> with <span class="math inline">\(C\)</span>, and model three predicts <span class="math inline">\(Tr_1\)</span> with <span class="math inline">\(Tr_2\)</span>. The triangle plot in Figure <a href="effects-of-tutoring-on-course-grades.html#fig:triangleplot">10.1</a> depicts the fitted values (i.e. propensity scores) from the three models on each edge of the triangle. Since each unit has a propensity score in two of the three models, their scores are connected. We can then calculate three distances between propensity scores for each possible matched triplet using the three models. Given those distances, the matched triplets with the smallest standardized distance (i.e. <span class="math inline">\(D_{x,y} = \frac{| PS_{x} - PS_{y} |}{sd(PS)}\)</span>) are retained. Several methods for determining which matched triplets to retain are provided with the possibility of the researcher to implement their own. The black lines in Figure <a href="effects-of-tutoring-on-course-grades.html#fig:triangleplot">10.1</a> represent one matched triplet (i.e. one row in the returned data frame).</p>
<p>Propensity score analysis of two groups typically use dependent sample <em>t</em>-tests <span class="citation">(Austin 2010)</span>. The analogue for matched triplets include repeated measures ANOVA and the Freidman Rank Sum Test. The <code>TriMatch</code> package provides utility functions for conducting and visualizing these statistical tests. Moreover, a set of functions extending <code>PSAgraphics</code> <span class="citation">(J. E. Helmreich and Pruzek 2009)</span> for matched triplets to check covariate balance are provided.</p>
<div id="the-trimatch-algorithm" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> The <code>TriMatch</code> Algorithm<a class="anchor" aria-label="anchor" href="#the-trimatch-algorithm"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>trips</code> and <code>trimatch</code> functions are used to estimate the propensity scores and find the best matched triplets, respectively.</p>
<p>A. Propensity scores are estimated for three models using logistic regression.
<span class="math display">\[{ PS }_{ 1 }=e({ x }_{ { T }_{ 1 }C })=Pr(z=1|{ X }_{ { T }_{ 1 }C })\]</span>
<span class="math display">\[{ PS }_{ 2 }=e({ x }_{ { T }_{ 2 }C })=Pr(z=1|{ X}_{ { T }_{ 2 }C })\]</span>
<span class="math display">\[{ PS }_{ 3 }=e({ x }_{ { T }_{ 2 }{ T }_{ 1 } })=Pr(z=1|{ X }_{ { T }_{ 2 }{ T }_{ 1 } })\]</span></p>
<p>B. Match order is determined. The default is to start with the larger of the two treatments, followed the second treatment, and lastly the control group. However, the match order is configurable vis-a-vis the <code>match.order</code> parameter.</p>
<p>C. Three distance matrices are calculated, <span class="math inline">\(D_1\)</span>, <span class="math inline">\(D_2\)</span>, and <span class="math inline">\(D_3\)</span> corresponding to the propensity scores estimated in step <a href="#item:ps"><strong>??</strong></a>. That is, <span class="math inline">\(D_1\)</span> is a <span class="math inline">\(n_{Tr_1}\)</span> x <span class="math inline">\(n_{Tr_2}\)</span> matrix where <span class="math inline">\(D_1[x,y]\)</span> is the standardized distance between <span class="math inline">\(PS_1[x]\)</span> and <span class="math inline">\(PS_1[y]\)</span>.</p>
<p>D. Distances greater than the caliper, 0.25 by default as recommended by <span class="citation">(Rosenbaum and Rubin 1985)</span>, are eliminated. The caliper is specified in standard units so 0.25 corresponds to one-quarter of one standard deviation.</p>
<p>E. If partial exact matching is desired, three logical matrices are created with the same dimensions as the distance matrices calculated in step <a href="#item:distance"><strong>??</strong></a>. That is, position <span class="math inline">\(x,y\)</span> in the matrix is true if the covariate(s) to match exactly on between unit <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> match exactly. Distances where exact there are not exact matches are eliminated.</p>
<p>F. For the remaining units, all possible combinations of matched triplets are formed and a total standardized distance is calculated.</p>
<p>The result of the above procedure is the equivalent of caliper matching in the two group case. That is, all possible matches within a specified caliper are retained. This can be achieved by specifying <code>method = NULL</code> parameter to the <code>trimatch</code> function. Two additional methods are provided to reduce the number of matched triplets. The <code>maximumTreat</code> method attempts to reduce the number of duplicate treatment units. This is analogous to matching without replacement in the two group case. However, treatment 1 units may be matched to two different treatment 2 units if that treatment 2 unit would otherwise not be matched. The <code>OneToN</code> method will allow the user to specify exactly how many times each treatment 1 and treatment 2 may be reused.</p>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="chapter-non-binary.html"><span class="header-section-number">8</span> Non-Binary Treatments</a></div>
<div class="next"><a href="effects-of-tutoring-on-course-grades.html"><span class="header-section-number">10</span> Effects of Tutoring on Course Grades</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>In this chapter</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#introduction"><span class="header-section-number">9</span> Introduction</a></li>
<li><a class="nav-link" href="#the-trimatch-algorithm"><span class="header-section-number">9.1</span> The TriMatch Algorithm</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jbryer/psa/blob/master/book/08-TriMatch.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jbryer/psa/edit/master/book/08-TriMatch.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
      <div class="book-extra">
        <ul class="list-unstyled">
<li><a href="https://github.com/jbryer/psa/actions/workflows/bookdown.yaml"><img src="https://github.com/jbryer/psa/actions/workflows/bookdown.yaml/badge.svg" alt="Bookdown Status"></a></li>
          <li><a href="https://www.repostatus.org/#wip"><img src="https://www.repostatus.org/badges/latest/wip.svg" border="0" alt="Project Status: WIP - Initial development is in progress, but there has not yet been a stable, usable release suitable for the public."></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Applied Propensity Score Analysis with R</strong>" was written by Jason Bryer, Ph.D.. It was last built on 2025-04-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
